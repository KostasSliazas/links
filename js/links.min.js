(w=>{const checkboxes=document.getElementById("check-boxes"),selection=document.getElementById("select"),choise=document.getElementById("choises"),createLink=document.getElementById("create-link"),outpus=document.getElementById("outpus"),closeEx=document.getElementById("exit"),closeBtn=document.getElementById("exit1"),opensBtn=document.getElementById("open"),adition=document.getElementById("aditions"),search=document.getElementById("site-search"),copyAll=document.getElementById("copy-links"),exportJson=document.getElementById("export-json"),showExport=document.getElementById("export-div"),links=document.getElementById("links"),found=document.getElementById("founded"),docfrag=document.createDocumentFragment(),checkeds=document.getElementsByName("check")[0],filteredExport=document.getElementById("filter"),classSwich=()=>checkeds.checked?outpus.classList.add("checks"):outpus.classList.remove("checks");let active=!1;function showCheckboxes(e){if("create-link"!==e.target.id)if("select"!==e.target.id||selection.classList.contains("open")){if("LABEL"===e.target.tagName||"INPUT"===e.target.tagName)return;selection.classList.remove("open"),checkboxes.style.display="none",addTextOfChecked("")}else selection.classList.add("open"),checkboxes.style.display="block"}function loopOverInputs(){const checked=[];return[...checkboxes.getElementsByTagName("INPUT")].forEach(e=>{e.checked&&checked.push(e.value)}),checked}function addTextOfChecked(m){choise.innerHTML=m||loopOverInputs().join(", ")}function hide(e){e.style.display="none"===e.style.display?(active=!0,"block"):(active=!1,"none")}function setLinks(){const url=document.getElementById("urls").value;if(url.length>0){const fav=extractHostname(url),createLinkObject={text:adition.value,url:fav,full:url,type:loopOverInputs()};return createLinkObject}return addTextOfChecked("No URL defined"),!1}function addStorage(){if("localStorage"in w){if(setLinks()){const key=JSON.stringify(setLinks().full).slice(1,-1),data=JSON.stringify(setLinks());w.localStorage.setItem(key,data)}}else w.alert("no localStorage in window")}function extractHostname(url){let hostname;return hostname=url.indexOf("//")>-1?url.split("/")[2]:url.split("/")[0],hostname=hostname.split(":")[0],hostname=hostname.split("?")[0],hostname}function loopLocalStorage(){search.focus(),search.value="",outpus.innerHTML="";let count=0;for(let i=0;i<w.localStorage.length;i++){const{url:url,type:type,full:full,text:text}=JSON.parse(w.localStorage.getItem(w.localStorage.key(i)));void 0!==full&&full.indexOf("http")>-1&&(count++,createElem(url,type,text,full))}0===count&&(outpus.innerHTML="No links added..."),outpus.appendChild(docfrag);const total=w.localStorage.length;found.innerHTML=`${count}/${count<total?count:total}`}function loopLocalStorageSearch(){outpus.innerHTML="";let count=0;for(let i=0,len=w.localStorage.length;i<len;i++){const{full:full,text:text,type:type,url:url}=JSON.parse(w.localStorage.getItem(w.localStorage.key(i)));if(void 0!==full&&full.indexOf("http")>-1){const values=type.concat(text.split(),url.split(),full.split()),isInarray=values.map(e=>!!e.toLowerCase().includes(search.value.toLowerCase()));isInarray.includes(!0)&&(count++,createElem(url,type,text,full))}}outpus.appendChild(docfrag);const total=w.localStorage.length;found.innerHTML=`${count}/${total}`,0===count&&(outpus.innerHTML="No results...")}function removeThis(e){return w.localStorage.removeItem(e.href),loopLocalStorage(),!1}function createElem(url,type,text,full){const elems=document.createElement("a"),types=document.createElement("span"),texts=document.createElement("span"),urls=document.createElement("span"),close=document.createElement("span");close.className="close",close.innerHTML="Ã—",close.onclick=()=>removeThis(elems),elems.setAttribute("href",full),elems.setAttribute("target","_blank"),types.textContent=type,urls.textContent=url,texts.textContent=text,urls.className="urls",elems.appendChild(urls),elems.appendChild(texts),elems.appendChild(types),elems.appendChild(close),docfrag.appendChild(elems)}checkeds.checked=!1,filteredExport.checked=!1,checkeds.addEventListener("input",classSwich),search.addEventListener("keydown",event=>{if("Enter"===event.key&&event.target.value.length>0)event.preventDefault(),loopLocalStorageSearch(),outpus.firstElementChild.focus();else{if("Backspace"!==event.key||0!==event.target.value.length)return!1;found.innerHTML="",loopLocalStorage()}},!0),document.addEventListener("keydown",e=>("Enter"===e.key||active||search.focus(),!1),!0),search.addEventListener("input",event=>{event.target.value.length>=0&&loopLocalStorageSearch()}),copyAll.addEventListener("click",e=>{hide(showExport)});const saveData=(()=>{const a=document.createElement("a");return(data,fileName)=>{const json=JSON.stringify(data,null,2),blob=new w.Blob([json],{type:"octet/stream"}),url=w.URL.createObjectURL(blob);a.href=url,a.download=fileName,a.click(),w.URL.revokeObjectURL(url)}})(),fileName=`localStorage${dateGet()}.json`;function dateGet(){const dateObj=new Date,month=dateObj.getUTCMonth()+1,day=dateObj.getUTCDate(),year=dateObj.getUTCFullYear(),sec=dateObj.getSeconds();return`(${year}-${month}-${day}-${sec})`}function loopStorageItems(){const data=[];for(let i=0;i<w.localStorage.length;i++)data.push(JSON.parse(w.localStorage.getItem(w.localStorage.key(i)))),data.join("\r\n");return data}createLink.addEventListener("click",()=>{addStorage(),loopLocalStorage()});const exportWithSearchFilter=()=>{const[...allFilteredElems]=outpus.getElementsByTagName("a"),elements=allFilteredElems.map(e=>({text:e.children[1].innerText,url:e.children[0].innerText,full:e.href,type:[e.children[2].innerText]}));return elements};function readSingleFile(e){const file=e.target.files[0];if(!file)return;const reader=new w.FileReader;reader.onload=e=>{const contents=e.target.result;displayContents(contents)},reader.readAsText(file)}function displayContents(data){const json=JSON.parse(data);for(let i=0;i<json.length;i++)w.localStorage.setItem(json[i].full,JSON.stringify(json[i]));hide(showExport),loopLocalStorage()}exportJson.addEventListener("click",()=>{filteredExport.checked?saveData(exportWithSearchFilter(),`fil-${fileName}`):saveData(loopStorageItems(),`all-${fileName}`),hide(showExport)}),search.addEventListener("dblclick",loopLocalStorage),document.addEventListener("click",showCheckboxes),closeEx.addEventListener("click",()=>hide(showExport)),closeBtn.addEventListener("click",()=>hide(links)),opensBtn.addEventListener("click",()=>hide(links)),addTextOfChecked(""),loopLocalStorage(),document.getElementById("file-input").addEventListener("change",readSingleFile,!1)})(window);